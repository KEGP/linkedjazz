events {}

http {
  ssl off;
  large_client_header_buffers 4 128k;

  server {
    rewrite ^/(.*)/$ /$1 last;

    location = /ontology {
      proxy_pass http://lode:8080/lode/extract?url=http://serveontologies:80/kejazz;
    }

    location /ontology {
      proxy_pass http://serveontologies:80/;
    }

    location = /lode/extract {
      # redirect localhost requests to lode
      if ($args ~ "(.*)url=http:\/\/localhost:8080\/ontology\/(.*)") {
        proxy_pass http://lode:8080/lode/extract?url=http://serveontologies:80/$2;
      }
    }

    location /lode {
      proxy_pass http://lode:8080/lode;
    }

    location /webvowl/ {
      proxy_pass http://webvowl:5000/;
    }

    location /sparqlanything/ {
      proxy_pass http://sparqlanything:3000/;
    }

    location /sparql {
      proxy_pass http://virtuoso:8890/sparql;
    }

    location /lodview/ {
      proxy_pass http://lodview:8080/lodview/;
    }

    location /resource/ {
      proxy_pass http://lodview:8080/lodview/;
    }
  }
}